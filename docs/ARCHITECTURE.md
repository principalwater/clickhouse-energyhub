# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Data Warehouse (DWH)

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

ClickHouse EnergyHub –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Data Warehouse, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â—É—é –≤—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –≥–∏–±–∫–æ—Å—Ç—å –¥–ª—è —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç—Ä–∞—Å–ª–∏.

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏

### –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Data Warehouse

```mermaid
graph TB
    %% –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    subgraph "üìä –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö"
        KAFKA[Kafka Topics<br/>energy_data_1min<br/>energy_data_5min]
        API[External APIs<br/>Energy Market Data<br/>River Flow Sensors]
        FILES[File Sources<br/>CSV, JSON, XML]
    end
    
    %% ClickHouse –∫–ª–∞—Å—Ç–µ—Ä
    subgraph "üóÑÔ∏è ClickHouse Cluster (dwh_prod)"
        subgraph "Shard 1"
            CH1[clickhouse-01<br/>Replica 1]
            CH3[clickhouse-03<br/>Replica 2]
        end
        subgraph "Shard 2"
            CH2[clickhouse-02<br/>Replica 1]
            CH4[clickhouse-04<br/>Replica 2]
        end
        subgraph "Coordination"
            CHK1[Keeper 1]
            CHK2[Keeper 2]
            CHK3[Keeper 3]
        end
    end
    
    %% –°–ª–æ–∏ –¥–∞–Ω–Ω—ã—Ö
    subgraph "üì• Raw Layer (–ò–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)"
        RAW_RF[raw.river_flow<br/>–†–µ—á–Ω–æ–π —Å—Ç–æ–∫]
        RAW_EC[raw.energy_consumption<br/>–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏]
        RAW_MD[raw.market_data<br/>–†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ]
        RAW_DEV[raw.devices<br/>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞]
        RAW_LOC[raw.locations<br/>–õ–æ–∫–∞—Ü–∏–∏]
    end
    
    subgraph "üîß ODS Layer (–û—á–∏—Å—Ç–∫–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è)"
        ODS_EC[ods.energy_consumption<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è]
        ODS_DEV[ods.devices<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤]
        ODS_LOC[ods.locations<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏]
    end
    
    subgraph "üßπ DDS Layer (–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è)"
        DDS_RF_CLEAN[dds.river_flow_clean<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –¥—É–±–ª–µ–π]
        DDS_MD_CLEAN[dds.market_data_clean<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ]
        DDS_EC[dds.energy_consumption<br/>–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è]
        DDS_RF_VIEW[dds.river_flow_view<br/>View –¥–ª—è –¥–æ—Å—Ç—É–ø–∞]
        DDS_MD_VIEW[dds.market_data_view<br/>View –¥–ª—è –¥–æ—Å—Ç—É–ø–∞]
    end
    
    subgraph "üìä CDM Layer (–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫—É–±—ã)"
        CDM_EC_DAILY[cdm.energy_consumption_daily<br/>–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞]
        CDM_DEV_PERF[cdm.device_performance<br/>–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤]
    end
    
    %% –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
    KAFKA --> RAW_RF
    KAFKA --> RAW_MD
    API --> RAW_EC
    API --> RAW_DEV
    FILES --> RAW_LOC
    
    %% –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
    RAW_EC --> ODS_EC
    RAW_DEV --> ODS_DEV
    RAW_LOC --> ODS_LOC
    
    RAW_RF --> DDS_RF_CLEAN
    RAW_MD --> DDS_MD_CLEAN
    ODS_EC --> DDS_EC
    
    DDS_RF_CLEAN --> DDS_RF_VIEW
    DDS_MD_CLEAN --> DDS_MD_VIEW
    
    DDS_EC --> CDM_EC_DAILY
    DDS_DEV --> CDM_DEV_PERF
    
    %% ClickHouse –∫–ª–∞—Å—Ç–µ—Ä
    RAW_RF -.-> CH1
    RAW_RF -.-> CH3
    RAW_MD -.-> CH2
    RAW_MD -.-> CH4
    
    %% –°—Ç–∏–ª–∏
    classDef rawLayer fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef odsLayer fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef ddsLayer fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef cdmLayer fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef cluster fill:#fce4ec,stroke:#880e4f,stroke-width:3px
    
    class RAW_RF,RAW_EC,RAW_DEV,RAW_LOC rawLayer
    class ODS_EC,ODS_DEV,ODS_LOC odsLayer
    class DDS_RF_CLEAN,DDS_EC,DDS_RF_VIEW ddsLayer
    class CDM_EC_DAILY,CDM_DEV_PERF cdmLayer
    class CH1,CH2,CH3,CH4,CHK1,CHK2,CHK3 cluster
```

### –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

```mermaid
flowchart TD
    %% –ò—Å—Ç–æ—á–Ω–∏–∫–∏
    subgraph "üåä –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö"
        KAFKA_1MIN[Kafka: energy_data_1min<br/>–†–µ—á–Ω–æ–π —Å—Ç–æ–∫ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É]
        KAFKA_5MIN[Kafka: energy_data_5min<br/>–†—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω]
        SENSORS[IoT Sensors<br/>–†–µ—á–Ω—ã–µ –¥–∞—Ç—á–∏–∫–∏<br/>–≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–µ —Å—á–µ—Ç—á–∏–∫–∏]
        MARKET_API[Energy Market API<br/>–¶–µ–Ω—ã, –æ–±—ä–µ–º—ã, –∑–æ–Ω—ã]
    end
    
    %% Airflow DAG'–∏
    subgraph "üîÑ Airflow Orchestration"
        DAG_DEDUP[deduplication_pipeline<br/>–ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç]
        DAG_BACKUP[clickhouse_backup_pipeline<br/>–ï–∂–µ–¥–Ω–µ–≤–Ω–æ]
        DAG_DBT[dbt_pipeline<br/>–ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é]
        DAG_DATA[data_processing_pipeline<br/>–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ]
    end
    
    %% ClickHouse —Ç–∞–±–ª–∏—Ü—ã
    subgraph "üóÑÔ∏è ClickHouse Tables"
        subgraph "Raw Layer"
            RAW_RF[raw.river_flow<br/>timestamp, river_name, ges_name<br/>water_level_m, flow_rate_m3_s, power_output_mw]
            RAW_EC[raw.energy_consumption<br/>device_id, location_id, timestamp<br/>energy_kwh, voltage, current_amp, power_factor]
            RAW_DEV[raw.devices<br/>device_id, device_name, device_type<br/>manufacturer, model, specifications]
            RAW_LOC[raw.locations<br/>location_id, location_name, region<br/>city, country, coordinates]
        end
        
        subgraph "ODS Layer"
            ODS_EC[ods.energy_consumption<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è<br/>–ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è]
            ODS_DEV[ods.devices<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤<br/>–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –∏ –æ–±–æ–≥–∞—â–µ–Ω–∏–µ]
            ODS_LOC[ods.locations<br/>–û—á–∏—â–µ–Ω–Ω—ã–µ –ª–æ–∫–∞—Ü–∏–∏<br/>–ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è]
        end
        
        subgraph "DDS Layer"
            DDS_RF_CLEAN[dds.river_flow_clean<br/>–î–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ<br/>ROW_NUMBER() OVER (PARTITION BY ges_name, timestamp, river_name)]
            DDS_MD_CLEAN[dds.market_data_clean<br/>–î–µ–¥—É–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ<br/>–ö–ª—é—á–∏: timestamp, trading_zone]
            DDS_EC[dds.energy_consumption<br/>–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è<br/>–ê–Ω–æ–º–∞–ª–∏–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è, –∞–≥—Ä–µ–≥–∞—Ü–∏—è]
            DDS_RF_VIEW[dds.river_flow_view<br/>View –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—á–∏—â–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º]
            DDS_MD_VIEW[dds.market_data_view<br/>View –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—á–∏—â–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º]
        end
        
        subgraph "CDM Layer"
            CDM_EC_DAILY[cdm.energy_consumption_daily<br/>–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è<br/>total_energy_kwh, avg_energy_kwh, anomaly_percentages]
            CDM_DEV_PERF[cdm.device_performance<br/>KPI —É—Å—Ç—Ä–æ–π—Å—Ç–≤<br/>efficiency, uptime, maintenance_needed]
        end
    end
    
    %% dbt –º–æ–¥–µ–ª–∏
    subgraph "üßπ dbt Models"
        DBT_RAW[raw_* models<br/>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Kafka]
        DBT_ODS[ods_* models<br/>–û—á–∏—Å—Ç–∫–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è]
        DBT_DDS[dds_* models<br/>–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è]
        DBT_CDM[cdm_* models<br/>–ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞]
    end
    
    %% –ü–æ—Ç–æ–∫–∏
    KAFKA_1MIN --> DAG_DATA
    KAFKA_5MIN --> DAG_DATA
    SENSORS --> DAG_DATA
    MARKET_API --> DAG_DATA
    
    DAG_DATA --> RAW_RF
    DAG_DATA --> RAW_EC
    DAG_DATA --> RAW_DEV
    DAG_DATA --> RAW_LOC
    
    %% –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ dbt
    RAW_EC --> DBT_ODS
    RAW_DEV --> DBT_ODS
    RAW_LOC --> DBT_ODS
    
    DBT_ODS --> ODS_EC
    DBT_ODS --> ODS_DEV
    DBT_ODS --> ODS_LOC
    
    RAW_RF --> DAG_DEDUP
    RAW_EC --> DAG_DEDUP
    
    DAG_DEDUP --> DBT_DDS
    DBT_DDS --> DDS_RF_CLEAN
    DBT_DDS --> DDS_EC
    
    DDS_RF_CLEAN --> DDS_RF_VIEW
    DDS_EC --> DBT_CDM
    DBT_CDM --> CDM_EC_DAILY
    DBT_CDM --> CDM_DEV_PERF
    
    %% –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
    DAG_DEDUP --> DBT_RAW
    DAG_DEDUP --> DBT_ODS
    
    %% –°—Ç–∏–ª–∏
    classDef source fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef airflow fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef clickhouse fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef dbt fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    
    class KAFKA_1MIN,KAFKA_5MIN,SENSORS,MARKET_API source
    class DAG_DEDUP,DAG_BACKUP,DAG_DBT,DAG_DATA airflow
    class RAW_RF,RAW_MD,DDS_RF_CLEAN,DDS_MD_CLEAN,CDM_EC_DAILY,CDM_DEV_PERF clickhouse
    class DBT_RAW,DBT_ODS,DBT_DDS,DBT_CDM dbt
```

### –ù–µ–π–º–∏–Ω–≥ –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏

**Raw Layer:**
- –¢–∞–±–ª–∏—Ü—ã: `raw_[entity_name]`
- –ö–æ–ª–æ–Ω–∫–∏: `[original_name]` (–±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤)
- –ò–Ω–¥–µ–∫—Å—ã: `idx_[table]_[columns]`

**ODS Layer:**
- –¢–∞–±–ª–∏—Ü—ã: `ods_[entity_name]`
- –ö–æ–ª–æ–Ω–∫–∏: `[standardized_name]`
- –ò–Ω–¥–µ–∫—Å—ã: `idx_ods_[table]_[columns]`

**DDS Layer:**
- –¢–∞–±–ª–∏—Ü—ã: `dds_[entity_name]_[suffix]`
- –ö–æ–ª–æ–Ω–∫–∏: `[business_name]`
- –ò–Ω–¥–µ–∫—Å—ã: `idx_dds_[table]_[columns]`

**CDM Layer:**
- –¢–∞–±–ª–∏—Ü—ã: `cdm_[granularity]_[entity]_[type]`
- –ö–æ–ª–æ–Ω–∫–∏: `[metric_name]` –∏–ª–∏ `[dimension_name]`
- –ò–Ω–¥–µ–∫—Å—ã: `idx_cdm_[table]_[columns]`

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
External Sources ‚Üí Raw Layer ‚Üí ODS Layer ‚Üí DDS Layer ‚Üí CDM Layer ‚Üí BI Tools
     ‚Üì              ‚Üì          ‚Üì          ‚Üì          ‚Üì          ‚Üì
  Ingestion    Validation  Cleaning   Business    Analytics  Reporting
              & Audit     & ETL      Logic      & Aggregation
```

### –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–æ–≤:

#### 1. **Ingestion Flow**
```
API/File ‚Üí Kafka ‚Üí Raw Tables ‚Üí Validation ‚Üí ODS Tables
```

#### 2. **Processing Flow**
```
ODS ‚Üí dbt Models ‚Üí DDS Clean Tables ‚Üí Business Logic ‚Üí DDS Views
```

#### 3. **Analytics Flow**
```
DDS ‚Üí Aggregation ‚Üí CDM Tables ‚Üí BI Tools ‚Üí Dashboards
```

## üèóÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- **ClickHouse** - –æ—Å–Ω–æ–≤–Ω–∞—è –°–£–ë–î –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **PostgreSQL** - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏

### **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è**
- **Apache Airflow** - –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
- **dbt** - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **Kafka** - –ø–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**
- **Apache Superset** - –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞—à–±–æ—Ä–¥—ã
- **Metabase** - —Å–∞–º–æ–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **Grafana** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Terraform** - –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥
- **Portainer** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

## üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### **Entity-Relationship Model**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    Locations    ‚îÇ    ‚îÇ     Devices     ‚îÇ    ‚îÇ Energy Meters   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ location_id (PK)‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚î§ location_id (FK)‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚î§ device_id (FK)  ‚îÇ
‚îÇ location_name   ‚îÇ    ‚îÇ device_id (PK)  ‚îÇ    ‚îÇ meter_id (PK)   ‚îÇ
‚îÇ region          ‚îÇ    ‚îÇ device_type     ‚îÇ    ‚îÇ timestamp       ‚îÇ
‚îÇ coordinates     ‚îÇ    ‚îÇ manufacturer    ‚îÇ    ‚îÇ energy_kwh      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   River Flow    ‚îÇ    ‚îÇ Market Data     ‚îÇ    ‚îÇ Energy Prices   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ flow_id (PK)    ‚îÇ    ‚îÇ market_id (PK)  ‚îÇ    ‚îÇ price_id (PK)   ‚îÇ
‚îÇ location_id (FK)‚îÇ    ‚îÇ timestamp       ‚îÇ    ‚îÇ timestamp       ‚îÇ
‚îÇ timestamp       ‚îÇ    ‚îÇ trading_zone    ‚îÇ    ‚îÇ region          ‚îÇ
‚îÇ water_level     ‚îÇ    ‚îÇ volume_mwh      ‚îÇ    ‚îÇ price_eur_mwh   ‚îÇ
‚îÇ flow_rate       ‚îÇ    ‚îÇ price_eur_mwh   ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Dimensional Model (CDM)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Fact Table: Energy Facts                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ fact_id (PK)                                                ‚îÇ
‚îÇ timestamp (FK) ‚Üí Date Dimension                             ‚îÇ
‚îÇ location_id (FK) ‚Üí Location Dimension                       ‚îÇ
‚îÇ device_id (FK) ‚Üí Device Dimension                           ‚îÇ
‚îÇ energy_kwh (Measure)                                        ‚îÇ
‚îÇ cost_eur (Measure)                                          ‚îÇ
‚îÇ efficiency_ratio (Measure)                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Date Dimension  ‚îÇ    ‚îÇLocation Dimension    ‚îÇDevice Dimension ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ date_id (PK)    ‚îÇ    ‚îÇ location_id (PK)‚îÇ    ‚îÇ device_id (PK)  ‚îÇ
‚îÇ date            ‚îÇ    ‚îÇ location_name   ‚îÇ    ‚îÇ device_name     ‚îÇ
‚îÇ day_of_week     ‚îÇ    ‚îÇ region          ‚îÇ    ‚îÇ device_type     ‚îÇ
‚îÇ month           ‚îÇ    ‚îÇ city            ‚îÇ    ‚îÇ manufacturer    ‚îÇ
‚îÇ quarter         ‚îÇ    ‚îÇ country         ‚îÇ    ‚îÇ model           ‚îÇ
‚îÇ year            ‚îÇ    ‚îÇ coordinates     ‚îÇ    ‚îÇ capacity_mw     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ –ù–µ–π–º–∏–Ω–≥ –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏

### **–û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã**
- **Snake_case** –¥–ª—è –≤—Å–µ—Ö –∏–º–µ–Ω
- **–ü—Ä–µ—Ñ–∏–∫—Å—ã** –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ—è
- **–°—É—Ñ—Ñ–∏–∫—Å—ã** –¥–ª—è —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞
- **–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫** –¥–ª—è –≤—Å–µ—Ö –∏–º–µ–Ω

### **–°–ª–æ–∏ –¥–∞–Ω–Ω—ã—Ö**
```
raw_*          # –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
ods_*          # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
dds_*_clean    # –û—á–∏—â–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
dds_*_view     # –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏
cdm_*_*        # –ö–æ–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
```

### **–¢–∏–ø—ã –æ–±—ä–µ–∫—Ç–æ–≤**
```
*_local        # –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã ClickHouse
*_mv           # Materialized Views
*_view         # –û–±—ã—á–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
*_clean        # –û—á–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
*_summary      # –°–≤–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
*_analytics    # –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
```

### **–ö–æ–ª–æ–Ω–∫–∏**
```
*_id           # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (PK/FK)
*_name         # –ù–∞–∑–≤–∞–Ω–∏—è
*_type         # –¢–∏–ø—ã
*_date         # –î–∞—Ç—ã
*_timestamp    # –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
*_amount       # –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞
*_price        # –¶–µ–Ω—ã
*_rate         # –°—Ç–∞–≤–∫–∏
*_level        # –£—Ä–æ–≤–Ω–∏
*_status       # –°—Ç–∞—Ç—É—Å—ã
*_created_at   # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
*_updated_at   # –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

### **–ò–Ω–¥–µ–∫—Å—ã**
```
idx_[table]_[columns]           # –û–±—ã—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
idx_[table]_[columns]_partial   # –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
idx_[table]_[columns]_unique    # –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ClickHouse

### **–î–≤–∏–∂–∫–∏ —Ç–∞–±–ª–∏—Ü**
```sql
-- –î–ª—è Raw –∏ ODS —Å–ª–æ–µ–≤
ENGINE = MergeTree()
PARTITION BY toYYYYMM(timestamp)
ORDER BY (timestamp, entity_id)

-- –î–ª—è DDS —Å–ª–æ–µ–≤
ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/table_name', '{replica}')
PARTITION BY toYYYYMM(timestamp)
ORDER BY (business_key, timestamp)

-- –î–ª—è CDM —Å–ª–æ–µ–≤
ENGINE = ReplicatedSummingMergeTree('/clickhouse/tables/{shard}/table_name', '{replica}')
PARTITION BY toYYYYMM(timestamp)
ORDER BY (dimension_keys)
```

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```sql
-- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
SET optimize_aggregation_in_order = 1;
SET max_threads = 8;
SET max_memory_usage = 8589934592; -- 8GB
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏**
- **Data Freshness** - –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **Data Quality** - –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö
- **Processing Time** - –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **Error Rate** - —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫
- **Storage Usage** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

### **–ê–ª–µ—Ä—Ç—ã**
- **Data Pipeline Failures** - —Å–±–æ–∏ –≤ –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö
- **Data Quality Issues** - –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º
- **Performance Degradation** - –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Storage Thresholds** - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

## üîÆ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤)**
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Data Lineage
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- [ ] –£–ª—É—á—à–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### **–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (6-12 –º–µ—Å—è—Ü–µ–≤)**
- [ ] –í–Ω–µ–¥—Ä–µ–Ω–∏–µ Machine Learning
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Real-time Analytics
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (1+ –≥–æ–¥)**
- [ ] Multi-cloud –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ ] Advanced Analytics Platform
- [ ] AI-powered Insights

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Quick Start Guide](../QUICK_START.md) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- [DBT Integration](DBT_INTEGRATION.md) - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å dbt
- [Monitoring Guide](MONITORING.md) - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
- [CI/CD Pipeline](CI_CD.md) - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
