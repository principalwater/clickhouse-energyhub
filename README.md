# EnergyHub: ClickHouse & Kafka Streaming Demo

**EnergyHub** ‚Äî —ç—Ç–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö Infrastructure as Code (IaC) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Terraform. –û–Ω —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –∏–º–∏—Ç–∏—Ä—É—è —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏–∑ —Å—Ñ–µ—Ä—ã —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫–∏.

–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –∫–ª–∞—Å—Ç–µ—Ä ClickHouse, –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π Apache Kafka –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Apache Airflow 3.0.4 –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á –∏ –Ω–∞–±–æ—Ä BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (Metabase, Superset) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –í—Å—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Terraform-–º–æ–¥—É–ª–∏ (`clickhouse-cluster`, `kafka`, `postgres`, `airflow`, `bi-infra`, `monitoring`).
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Production:** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∫–ª—é—á–∞—é—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –∏ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è ClickHouse, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è Kafka, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é PostgreSQL –ë–î, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Airflow 3.0.4 —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ health checks.
- **–ì–∏–±–∫–æ—Å—Ç—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–æ—á–Ω–æ –≤–∫–ª—é—á–∞—Ç—å –∏ –æ—Ç–∫–ª—é—á–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (Metabase, Superset, Airflow) –∏ –≤—ã–±–∏—Ä–∞—Ç—å —Ä–µ–∂–∏–º—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–ª–æ–∫–∞–ª—å–Ω—ã–π, —É–¥–∞–ª–µ–Ω–Ω—ã–π S3, –ª–æ–∫–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø).
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è "–∏–∑ –∫–æ—Ä–æ–±–∫–∏":** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö, —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.
- **ETL/ELT –ø–∞–π–ø–ª–∞–π–Ω—ã:** Apache Airflow 3.0.4 —Å –≥–æ—Ç–æ–≤—ã–º–∏ DAG'–∞–º–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ClickHouse –∏ Kafka.
- **CI/CD:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Terraform-–∫–æ–¥–∞.
- **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:** Python-—Å–∫—Ä–∏–ø—Ç—ã –∏–º–∏—Ç–∏—Ä—É—é—Ç –ø–æ—Ç–æ–∫–æ–≤—É—é –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ—Ä–≥–∞—Ö –Ω–∞ —ç–Ω–µ—Ä–≥–æ–±–∏—Ä–∂–µ –∏ –≥–∏–¥—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ì–≠–°.

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —à–µ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª—å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ Docker:

1.  **–ö–ª–∞—Å—Ç–µ—Ä ClickHouse (`clickhouse-cluster`):**
    - –û—Å–Ω–æ–≤–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö.
    - –í–∫–ª—é—á–∞–µ—Ç 4 –Ω–æ–¥—ã ClickHouse (2 —à–∞—Ä–¥–∞ –ø–æ 2 —Ä–µ–ø–ª–∏–∫–∏) –∏ 3 –Ω–æ–¥—ã ClickHouse Keeper –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏.
    - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –ª–æ–∫–∞–ª—å–Ω—ã–π –¥–∏—Å–∫ –∏ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
    - [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ README –º–æ–¥—É–ª—è...](./infra/terraform/modules/clickhouse-cluster/README.md)

2.  **Apache Kafka (`kafka`):**
    - –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Å–±–æ—Ä–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
    - –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Å Zookeeper, SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º, SASL/SCRAM –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–æ–ø–∏–∫–æ–≤ —Å TTL.
    - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–º–µ—à–∞–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤: PLAINTEXT –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ SASL_SSL –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤.
    - [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ README –º–æ–¥—É–ª—è...](./infra/terraform/modules/kafka/README.md)

3.  **PostgreSQL (`postgres`):**
    - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.
    - –ï–¥–∏–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä PostgreSQL —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Metabase, Superset –∏ Apache Airflow.
    - Production-ready –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å health checks –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.
    - [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ README –º–æ–¥—É–ª—è...](./infra/terraform/modules/postgres/README.md)

4.  **Apache Airflow 3.0.4 (`airflow`):**
    - –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö.
    - –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ 3.0.4 —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏: API Server, Scheduler, DAG Processor, Worker, Triggerer.
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ClickHouse –∏ Kafka –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è ETL/ELT –ø–∞–π–ø–ª–∞–π–Ω–æ–≤.
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL (–∏–∑ –º–æ–¥—É–ª—è postgres) –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ Redis –¥–ª—è Celery –±—Ä–æ–∫–µ—Ä–∞.
    - –ì–æ—Ç–æ–≤—ã–µ DAG'—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É ClickHouse –∏ Kafka.
    - –£–ª—É—á—à–µ–Ω–Ω—ã–µ health checks –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.
    - [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ README –º–æ–¥—É–ª—è...](./infra/terraform/modules/airflow/README.md)

5.  **BI-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (`bi-infra`):**
    - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ ClickHouse.
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL (–∏–∑ –º–æ–¥—É–ª—è postgres) –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±—ç–∫–µ–Ω–¥–∞ –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
    - –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å Metabase –∏/–∏–ª–∏ Apache Superset.
    - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ ClickHouse –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PostgreSQL.
    - [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ README –º–æ–¥—É–ª—è...](./infra/terraform/modules/bi-infra/README.md)

6.  **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (`monitoring`):**
    - –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç Portainer Community Edition –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—Å–µ—Ö Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
    - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ä–µ—Å—É—Ä—Å–æ–≤.
    - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ HTTP, —Ç–∞–∫ –∏ HTTPS –¥–æ—Å—Ç—É–ø —Å –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–∫.
    - [–ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ README –º–æ–¥—É–ª—è...](./infra/terraform/modules/monitoring/README.md)

## üîÑ –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–ú–æ–¥—É–ª–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ —Å —É—á–µ—Ç–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```mermaid
graph TB
    A[clickhouse-cluster] --> D[postgres]
    B[kafka] --> D
    D --> E[airflow]
    D --> F[bi-infra]
    A --> F
    F --> G[monitoring]
    E --> G
```

1. **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏** (—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
   - `clickhouse-cluster` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
   - `kafka` ‚Äî –ø–æ—Ç–æ–∫–æ–≤–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö

2. **PostgreSQL** (`postgres`):
   - –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –°–æ–∑–¥–∞–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –ë–î –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

3. **–ó–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã** (—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ PostgreSQL):
   - `airflow` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   - `bi-infra` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –¥–ª—è Metabase/Superset

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** (`monitoring`):
   - –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ—à–∞–≥–æ–≤–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –Ω–∞—à–µ–º—É —Ç—É—Ç–æ—Ä–∏–∞–ª—É:

‚û°Ô∏è **[TUTORIAL.md](./TUTORIAL.md)**

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:

| –°–µ—Ä–≤–∏—Å | URL | –û–ø–∏—Å–∞–Ω–∏–µ | –õ–æ–≥–∏–Ω | –ü–∞—Ä–æ–ª—å |
|--------|-----|----------|-------|---------|
| **Apache Airflow** | `http://localhost:8080` | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–¥–∞—á –∏ DAG'–æ–≤ | `admin` | –∏–∑ `terraform.tfvars` |
| **Airflow Flower** | `http://localhost:5555` | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ Celery –≤–æ—Ä–∫–µ—Ä–æ–≤ | ‚Äî | ‚Äî |
| **Metabase** | `http://localhost:3000` | BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ | –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ | –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ |
| **Apache Superset** | `http://localhost:8088` | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è BI-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ | `admin` | –∏–∑ `terraform.tfvars` |
| **Portainer** | `http://localhost:9443` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ | `admin` | –°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ |

### –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –±—Ä–æ–∫–µ—Ä—ã
| –°–µ—Ä–≤–∏—Å | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ü—Ä–æ—Ç–æ–∫–æ–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|----------|----------|
| **ClickHouse HTTP** | `http://localhost:8123` | HTTP | –ó–∞–ø—Ä–æ—Å—ã –∫ ClickHouse |
| **ClickHouse TCP** | `localhost:9000` | TCP | –ù–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª ClickHouse |
| **Kafka External** | `localhost:9093` | SASL_SSL | –í–Ω–µ—à–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã Kafka |
| **PostgreSQL** | `localhost:5432` | PostgreSQL | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ë–î |
| **Redis** | `localhost:6379` | Redis | Celery –±—Ä–æ–∫–µ—Ä –¥–ª—è Airflow |

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

–í—Å—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Terraform –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `infra/terraform`. –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- `terraform init`: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞.
- `terraform apply`: —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
- `terraform destroy`: –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏

–í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —á–∞—Å—Ç—è–º–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –ø–æ–º–æ—â—å—é —Ñ–ª–∞–≥–∞ `-target`:

```bash
# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ ClickHouse –∫–ª–∞—Å—Ç–µ—Ä–∞
terraform apply -target="module.clickhouse_cluster"

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ PostgreSQL
terraform apply -target="module.postgres"

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ Apache Airflow
terraform apply -target="module.airflow"

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
terraform apply -target="module.bi_infra"

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
terraform apply -target="module.monitoring"

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ Kafka
terraform apply -target="module.kafka"
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker logs airflow-api-server
docker logs postgres
docker logs kafka

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
docker network ls | grep -E "(clickhouse|kafka|postgres|airflow)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health checks
curl http://localhost:8080/health          # Airflow
curl http://localhost:8123/ping            # ClickHouse
curl http://localhost:3000/api/health      # Metabase
```
