# Airflow DAGs –¥–ª—è Energy Hub

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç DAG'–∏ –¥–ª—è Apache Airflow, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–∞–≤–ª—è—é—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ Energy Hub.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
airflow/
‚îú‚îÄ‚îÄ dags/                          # DAG —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ data_generation_pipeline.py    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ä–µ—á–Ω–æ–≥–æ —Å—Ç–æ–∫–∞ (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
‚îÇ   ‚îú‚îÄ‚îÄ market_data_pipeline.py        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ static_data_pipeline.py        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (—Ä–∞–∑ –≤ –¥–µ–Ω—å)
‚îÇ   ‚îú‚îÄ‚îÄ data_processing_pipeline.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ —Å–ª–æ–∏ (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ clickhouse_backup_pipeline.py  # –ë—ç–∫–∞–ø –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ClickHouse (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
‚îÇ   ‚îú‚îÄ‚îÄ dbt_pipeline.py                # –ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å dbt (–∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
‚îÇ   ‚îî‚îÄ‚îÄ energy_data_pipeline.py        # –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω (–∫–∞–∂–¥—ã–π —á–∞—Å)
‚îî‚îÄ‚îÄ README.md                      # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## DAG'–∏

### 1. data_generation_pipeline.py
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (`* * * * *`)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ä–µ—á–Ω–æ–º —Å—Ç–æ–∫–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ Kafka —Ç–æ–ø–∏–∫ `energy_data_1min`

### 2. market_data_pipeline.py
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (`*/5 * * * *`)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä—ã–Ω–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ Kafka —Ç–æ–ø–∏–∫ `energy_data_5min`

### 3. static_data_pipeline.py
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 (`0 2 * * *`)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–ì–≠–°, –¢–≠–°, –°–≠–°)
- –õ–æ–∫–∞—Ü–∏–∏ (—Ä–µ–≥–∏–æ–Ω—ã)
- –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
- –ü–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### 4. data_processing_pipeline.py
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç (`*/15 * * * *`)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å–ª–æ–∏:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö (DQ)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ—è ODS
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ—è DDS
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ—è CDM
- –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### 5. clickhouse_backup_pipeline.py
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 (`0 3 * * *`)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë—ç–∫–∞–ø –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ ClickHouse —á–µ—Ä–µ–∑ clickhouse-backup

### 6. dbt_pipeline.py
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç (`*/30 * * * *`)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–∞–π–ø–ª–∞–π–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å dbt –º–æ–¥–µ–ª—è–º–∏

### 7. energy_data_pipeline.py
**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π —á–∞—Å (`0 * * * *`)
**–û–ø–∏—Å–∞–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

DAG'–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏:
- **Kafka:** –î–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö
- **ClickHouse:** –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- **dbt:** –î–ª—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **Nord Pool API:** –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

DAG'–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–∫—Ä–∏–ø—Ç—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞ `../scripts/`:
- `clickhouse_utils.py` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ClickHouse
- `clickhouse_backup_manager.py` - –º–µ–Ω–µ–¥–∂–µ—Ä –±—ç–∫–∞–ø–æ–≤ ClickHouse
- `generate_static_data.py` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- `nordpool_api_client.py` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è Nord Pool API
- `kafka_producer/` - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Kafka

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

DAG'–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Airflow –ø—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ Terraform. –ü—É—Ç—å –∫ DAG'–∞–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `airflow_dags_path`.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Airflow UI:** http://localhost:8080
- **–õ–æ–≥–∏:** –î–æ—Å—Ç—É–ø–Ω—ã –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Airflow
- **–ú–µ—Ç—Ä–∏–∫–∏:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Apache Superset –¥–∞—à–±–æ—Ä–¥—ã
- **–ê–ª–µ—Ä—Ç–∏–Ω–≥:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ —Å–±–æ—è—Ö

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BI –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ BI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Airflow –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

**–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ:** [../docs/BI_CLICKHOUSE_SETUP.md](../docs/BI_CLICKHOUSE_SETUP.md)
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Metabase –∫ ClickHouse
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Superset –∫ ClickHouse  
- –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ DAG'–æ–≤
